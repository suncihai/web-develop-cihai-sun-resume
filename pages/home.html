<div class="page">
    <div style="background:#2ab350;height:120px;text-align:center;">
        <img src="./images/logo.png" alt="LineMoney" style="margin:30px;"/>
    </div>
    <div style="text-align:center;padding:10px;font-size:12px;">
       <div style="display:inline-block;text-align:center;margin:10px;">
          <img src="./images/exchange_visited.png"/>
          <p id="exchange_des" style="color:#2ab350;">汇款金额</p>
       </div>
       <div style="display:inline-block;text-align:center;margin:10px;">
          <img src="./images/recipient_unvisited.png"/>
          <p id="recipient_des" style="color:#bbb;">收款账户</p>
       </div>
       <div style="display:inline-block;text-align:center;margin:10px;">
          <img src="./images/payment_unvisited.png"/>
          <p id="payment_des" style="color:#bbb;">汇款方式</p>
       </div>
       <div style="display:inline-block;text-align:center;margin:10px;">
          <img src="./images/confirmation_unvisited.png"/>
          <p id="confirmation_des" style="color:#bbb;">最终确认</p>
       </div>
    </div>
    <div class="weui-cells weui-cells_form">
          <div class="weui-cell">
              <div class="weui-cell__hd">
                 <img id="exchange_flag" src="./images/USD.png"/ style="display:inline-block;vertical-align:middle;">
              </div>
              <div class="weui-cell__hd">
                  <select class="weui-select" name="selectfromcurrency" id="selectfromcurrency">
                      <option value="USD" selected>USD</option>
                      <option value="CNY">CNY</option>
                  </select>
              </div>
              <div class="weui-cell__bd">
                  <input id="exchange_amount" class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入汇款金额" style="text-align:right;font-size:20px;"/>
                  <span id="exchange_hint" style="font-size:10px;color:#aaa;float:right;">汇款金额</span>
              </div>
          </div>
          <div class="weui-cell">
              <div class="weui-cell__hd">
                 <img id="recipient_flag" src="./images/CNY.png"/ style="display:inline-block;vertical-align:middle;">
              </div>
              <div class="weui-cell__hd">
                  <select class="weui-select" name="selecttocurrency" id="selecttocurrency">
                      <option value="CNY" selected>CNY</option>
                      <option value="USD">USD</option>
                  </select>
              </div>
              <div class="weui-cell__bd">
                  <input id="recipient_amount" class="weui-input" type="number" pattern="[0-9]*" placeholder="0.00" style="text-align:right;font-size:20px;"/>
                  <span id="recipient_hint" style="font-size:10px;color:#aaa;float:right;">收款金额</span>
              </div>
          </div>
    </div>
    <div class="weui-cells__tips" style="font-size:13px;"><font color="#2ab350">参考汇率：</font><span id="exhangerate">1 USD = 6.4828 CNY</span></div>
    <div class="page__bd page__bd_spacing" style="margin:100px auto;">
       <a href="javascript:;" id="next-to-recipient" class="weui-btn weui-btn_primary js_item nextbutton" data-id="recipient" href="javascript:;">下一步</a>
    </div>
    <div class="page__ft">
        <a href="javascript:home()"><img src="./images/icon_footer.png" /></a>
    </div>
</div>
<script type="text/javascript">
    $(function(){
        var winH = $(window).height();
        var categorySpace = 10;
        var rate = 6.5121;

        $('.js_item').on('click', function(){
            if($(this).hasClass("weui-btn_disabled")){
               return false;
            }
            var id = $(this).data('id');
            setTimeout(function(){
                window.pageManager.go(id);
            },1100);
        });

        var $loadingToast = $('#loadingToast');
        $('.nextbutton').on('click', function(){
            if($(this).hasClass("weui-btn_disabled")){
               return false;
            }
            if ($loadingToast.css('display') != 'none') return;

            $loadingToast.fadeIn(100);
            setTimeout(function () {
                $loadingToast.fadeOut(100);
            },1000);
        });
         
        $("#exchange_amount").keyup(function(){
           $("#recipient_amount").val(($(this).val()*rate).toFixed(2));
           checkamount();
        });

        function checkamount(){
           if($("#exchange_amount").val()>2000&&($("#selectfromcurrency").val()=="USD")){
              $("#next-to-recipient").removeClass("weui-btn_primary").addClass("weui-btn_warn").addClass("weui-btn_disabled");
              $("#exchange_hint").html("汇款金额超过限额").css("color","red");
              $("#exchange_amount").css("color","red");
           }else if($("#exchange_amount").val()>50000&&($("#selectfromcurrency").val()=="CNY")){
              $("#next-to-recipient").removeClass("weui-btn_primary").addClass("weui-btn_warn").addClass("weui-btn_disabled");
              $("#exchange_hint").html("汇款金额超过限额").css("color","red");
              $("#exchange_amount").css("color","red");
           }else{
              $("#next-to-recipient").removeClass("weui-btn_warn").removeClass("weui-btn_disabled").addClass("weui-btn_primary");
              $("#exchange_hint").html("汇款金额").css("color","#aaa");
              $("#exchange_amount").css("color","black");
           }
        }

        $("#recipient_amount").keyup(function(){
           $("#exchange_amount").val(($(this).val()/rate).toFixed(2));
        });

        $("#selectfromcurrency").change(function(){
            if($(this).val()=="CNY"){
               exchangedirection("CNYtoUSD");
               $("#selecttocurrency").val("USD");
               $("#exhangerate").html("1 CNY = 0.1535 USD");
            }else{
               exchangedirection("USDtoCNY");
               $("#selecttocurrency").val("CNY");
               $("#exhangerate").html("1 USD = 6.4828 CNY");
            }
            rate = (1/rate).toFixed(4);
            $("#recipient_amount").val(($("#exchange_amount").val()*rate).toFixed(2));
            checkamount();
        });

        $("#selecttocurrency").change(function(){
            if($(this).val()=="CNY"){
               exchangedirection("USDtoCNY");
               $("#selectfromcurrency").val("USD");
               $("#exhangerate").html("1 USD = 6.4828 CNY");
            }else{
               exchangedirection("CNYtoUSD");
               $("#selectfromcurrency").val("CNY");
               $("#exhangerate").html("1 CNY = 0.1535 USD");
            }
            rate = (1/rate).toFixed(4);
            $("#exchange_amount").val(($("#recipient_amount").val()/rate).toFixed(2));
            checkamount();
        });

        function exchangedirection(direction){
           if(direction=="USDtoCNY"){
               $("#exchange_flag").prop("src","./images/USD.png");
               $("#recipient_flag").prop("src","./images/CNY.png");
           }else if(direction=="CNYtoUSD"){
              $("#exchange_flag").prop("src","./images/CNY.png");
              $("#recipient_flag").prop("src","./images/USD.png");
           }
        }
    });
</script>